<style>
#container {
    min-width:300px;
    min-height:200px;
    border:3px dashed #000;
  }
</style>
 <div id='container'></div>
<script>
    function addDNDListener(obj){
        obj.addEventListener('dragover',function(e){
            e.preventDefault();
            e.stopPropagation();
        },false);
        obj.addEventListener('dragenter',function(e){
            e.preventDefault();
            e.stopPropagation();
        },false);

        obj.addEventListener('drop',function(e){
            e.preventDefault();
            e.stopPropagation();
            var ul = document.createElement("ul");
            var fileList = e.dataTransfer.files;
            for(var i=0;i<fileList.length;i++){
                var file = fileList[i];
                var li = document.createElement('li');
                li.innerHTML = '<label id="'+file.name+'">'+file.name+':</label><progress value="0"max="100"></progress>';
                ul.appendChild(li);
            }
            document.getElementById('container').appendChild(ul);
            for(var i=0;i<fileList.length;i++){
                var file = fileList[i];
                uploadFile(file);
            }
        },false);
    }

    function uploadFile(file){
        var chunk = 8*1024*1024;
        var progress = document.getElementById(file.name).nextSibling;
        var reader = new FileReader();
        reader.readAsArrayBuffer(file);
        reader.onloadstart = function (e) {

        };
        reader.onprogress = function(e){
            progress.value = (e.loaded/e.total) * 100;
        };
        reader.onload = function(e){
            var start = 0;
            var chunks = [];
            var buf = new Int8Array(e.target.result);

            for (var i = 0; i < Math.ceil(e.total/chunk); i++) {
                var end = start + chunk;
                chunks[i] = buf.slice(start,end);
                start = end;
            }

            var query = {
                fileName: new Date().getTime(),
                fileSize: e.total,
                dataSize: chunk,
                extend: chunk
            };

            var queryStr = Object.getOwnPropertyNames(query).map( key => {
                return key + "=" + query[key];
            }).join("&");

            var xhr = new XMLHttpRequest();
            // xhr.timeout = 90000;

            for (var j = 0; j < chunks.length;j++){
                if (j === 0 || xhr.status === 200){
                    xhr.open("POST", "/welcome/test?="+queryStr+"&num="+j,false);
                    xhr.setRequestHeader("X-CSRF-TOKEN","{{ csrf_token()}}");
                    xhr.send(chunks[j]);
                    console.log(j);
                    console.log(xhr.status);
                }else {
                    console.log("失败");
                }
            }
        };
    }
    window.onload = function(){
        addDNDListener(document.getElementById('container'));
    };

</script>